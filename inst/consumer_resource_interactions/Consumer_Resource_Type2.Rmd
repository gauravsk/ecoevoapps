---
title: 'Consumer-Resource Variations'
author: "Rosa M. McGuire"
date: "5/27/2020"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Consumer- Resource Interactions {.tabset}

### Type II Functional Response


```{r, include=FALSE}
library(deSolve)
library(tidyverse)


# Consumer Resource Models: Type II Functional Response

lv_pred2 <- function(time,init,pars) {
  with (as.list(c(time,init,pars)), {
    # description of parameters:
    # r = per capita growth rate (prey)
    # a = attack rate 
    # T_h = handling time
    # e = conversion efficiency
    # d = predator death rate 
    
    dH_dt = r*H - (a*H*P)/(1 + a*T_h*H)
    dP_dt = e*(a*H*P)/(1 + a*T_h*H) - d*P
    return(list(c(dH = dH_dt, dP = dP_dt)))
  
  })
}

```
 

\[
\begin{eqnarray}
\frac{dH}{dt} = rH - \frac{aH}{1+aT_hH} P\\
\\
\frac{dP}{dt} = eP \frac{aH}{1+aT_hH} - dP
\end{eqnarray}
\]

Where:

* $H =$ Prey population size
* $P =$ Predator population size
* $r =$ per capita growth rate of Prey
* $a =$ Predator attack rate
* $T_h =$ Predator handling time
* $e =$ conversion efficiency
* $d =$ Predator death rate  

```{r eruptions, echo=FALSE}
sidebarLayout(
  sidebarPanel(
    ### Ask users for parameter values ----
    ## r, a, T_h, e, d
    
    sliderInput("r", label = "Per capita growth rate of Prey", min = .0001, max = 1.0, value = .5),
    sliderInput("a", label = "Predator attack rate", min = .001, max = 1.0, value = .1),
    sliderInput("T_h", label = "Predator handling time", min = 0.001, max = 1.0, value = 0.2),
    sliderInput("e", label = "Predator conversion efficiency", min = .001, max = 1.0, value = 1),
    sliderInput("d", label = "Per capita death rate of Predator", min = .0001, max = 1.0, value = .3),
    
    
      
    ### Ask users for initial conditions -----
    #N1, N2
    
    numericInput("H", label = "Initial population size of Prey", min = 1, value = 10),
    numericInput("P", label = "Initial population size of Predator", min = 1, value = 10),
    
    ### Ask users for time to simulate ----
    
    
    numericInput("t", label = "Timesteps", min = 1, value = 100),
    
  ),  
  
 
  mainPanel(renderPlot(lvpred2_plot()),renderPlot(lvpred2_np())),
  
  #mainPanel(renderPlot(lvpred2_np()))
)

 # Set the initial population sizes

init <- reactive({c(H = input$H , P = input$P)})

# Set the parameter values

    # description of parameters:
    # r = per capita growth rate (prey)
    # a = attack rate 
    # T_h = handling time
    # e = conversion efficiency
    # d = predator death rate 

pars <- reactive({c(r = input$r, a = input$a , T_h = input$T_h , e = input$e , d = input$d )})

# Time over which to simulate model dynamics
time <- reactive({seq(0,input$t,by = .1)})



# Use the lv_competition function above to run 
# the lotka-volterra competition model using the 
# parameter estimates defined above

lv_pred2_out <- reactive({data.frame(deSolve::ode(func = lv_pred2, y = init(), parms = pars(), times = time()))})
  

# Reshape the data so that population sizes of both 
# species are in one column, and an extra column to define
# species name. This helps with the plotting...

lv_pred2_out_long <- reactive({pivot_longer(lv_pred2_out(), c(H,P), "Population")})


# Plots
lvpred2_plot <- reactive({ggplot(lv_pred2_out_long()) + 
  geom_line(aes(x = time, y = value, color = Population), size = 2) + 
  scale_color_brewer(palette = "Set1") +
  ylab("Population size")  })

lvpred2_np <- reactive(plot(lv_pred2_out()$H, lv_pred2_out()$P, type='l',xlab="Number of Prey",ylab="Number of Predators"))


   
```

### Rosenzweig- MacArthur Model 

```{r, include=FALSE}
library(deSolve)
library(tidyverse)
library(patchwork)

# Consumer Resource Models: Rosenzweig-MacArthur Model

rm_predation <-function(time,init,params) {
  with (as.list(c(time,init,params)), {
    # description of parameters:
    # r = per capita growth rate (prey)
    # K = prey carrying capacity
    # a = attack rate 
    # T_h = handling time
    # e = conversion efficiency
    # d = predator death rate 
    
    dH_dt = r*H*(1 - H/K) - (a*H*P)/(1 + a*T_h*H)
    dP_dt = e*(a*H*P)/(1 + a*T_h*H) - d*P
    return(list(c(dH = dH_dt, dP = dP_dt)))
    
  })
}

```
 

\[
\begin{eqnarray}
\frac{dH}{dt} = rH  \biggl(1-\frac{H}{K}\biggr) - \frac{aHP}{1+aT_hH} \\
\\
\frac{dP}{dt} = e \frac{aHP}{1+aT_hH} - dP
\end{eqnarray}
\]

Where:

* $H =$ Prey population size
* $P =$ Predator population size
* $r =$ per capita growth rate of Prey
* $K =$ Prey carrying capacity
* $a =$ Predator attack rate
* $T_h =$ Predator handling time
* $e =$ conversion efficiency
* $d =$ Predator death rate  

```{r rosenzweig-macarthur, echo=FALSE}
sidebarLayout(
  sidebarPanel(
    ### Ask users for parameter values ----
    ## r, a, T_h, e, d
    
    sliderInput("r_rm", label = "Per capita growth rate of Prey", min = .0001, max = 1.0, value = .2),
    numericInput("K_rm", label = "Prey carrying capacity", min = 1, value = 150),
    sliderInput("a_rm", label = "Predator attack rate", min = .001, max = 1.0, value = .02),
    sliderInput("T_h_rm", label = "Predator handling time", min = 0.001, max = 1.0, value = 1),
    sliderInput("e_rm", label = "Predator conversion efficiency", min = .001, max = 1.0, value = 1),
    sliderInput("d_rm", label = "Per capita death rate of Predator", min = .0001, max = 1.0, value = .4),
    
    
      
    ### Ask users for initial conditions -----
    #N1, N2
    
    numericInput("H_rm", label = "Initial population size of Prey", min = 1, value = 30),
    numericInput("P_rm", label = "Initial population size of Predator", min = 1, value = 25),
    
    ### Ask users for time to simulate ----
    
    
    numericInput("t_rm", label = "Timesteps", min = 1, value = 100),
    
  ),  
  
 
  mainPanel(renderPlot(rm_plot()),renderPlot(rm_np())),
  
  #mainPanel(renderPlot(lvpred2_np()))
)

 # Set the initial population sizes

init_rm <- reactive({c(H = input$H_rm , P = input$P_rm)})

# Set the parameter values

    # description of parameters:
    # r = per capita growth rate (prey)
    # a = attack rate 
    # T_h = handling time
    # e = conversion efficiency
    # d = predator death rate 

params_rm <- reactive({c(r = input$r_rm, K = input$K_rm, a = input$a_rm , T_h = input$T_h_rm , e = input$e_rm , d = input$d_rm )})

# Time over which to simulate model dynamics
time_rm <- reactive({seq(0,input$t_rm,by = .1)})



# Use the lv_competition function above to run 
# the lotka-volterra competition model using the 
# parameter estimates defined above

rm_out <- reactive({data.frame(deSolve::ode(func = rm_predation, y = init_rm(), parms = params_rm(), times = time_rm()))})
  

# Reshape the data so that population sizes of both 
# species are in one column, and an extra column to define
# species name. This helps with the plotting...

rm_out_long <- reactive({pivot_longer(rm_out(), c(H,P), "Population")})


# Plots
rm_plot <- reactive({ggplot(rm_out_long()) + 
  geom_line(aes(x = time, y = value, color = Population), size = 2) + 
  scale_color_brewer(palette = "Set1") +
  ylab("Population size")  })

rm_np <- reactive(plot(rm_out()$H, rm_out()$P, type='l',xlab="Number of Prey",ylab="Number of Predators"))


   
```
